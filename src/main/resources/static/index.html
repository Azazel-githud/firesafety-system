<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .form-group, .search-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        .product-item { padding: 10px; border: 1px solid #ddd; margin: 5px 0; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏</h1>
        
        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ -->
        <div class="form-section">
            <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ç—Ä–µ–≤–æ–≥—É</h2>
            <form id="productForm">
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–≤–æ–≥–∏:</label>
                    <input type="text" id="title" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" required>
                </div>
                <div class="form-group">
                    <label>–°—Ç–∞—Ç—É—Å:</label>
                    <input type="text" id="status" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞—Ç—É—Å" required>
                </div>
                <div class="form-group">
                    <label>–õ–æ–∫–∞—Ü–∏—è:</label>
                    <input type="text" id="location" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–∫–∞—Ü–∏—é" required>
                </div>
                <button type="submit">–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–≤–æ–≥—É</button>
            </form>
            <div id="formMessage"></div>
        </div>

        <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
        <div class="search-section">
            <h2>–ù–∞–π—Ç–∏ —Ç—Ä–µ–≤–æ–≥—É</h2>
            <form id="productSearch">
                <div class="search-group">
                    <label for="search">–í–≤–µ–¥–∏—Ç–µ id:</label>
                    <input type="number" id="searchId">
                </div>
                <button type="submit">–ù–∞–π—Ç–∏</button>
                <div id="foundproducts">
                    
                </div>
            </form>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ -->
        <div class="products-section">
            <h2>–°–ø–∏—Å–æ–∫ —Ç—Ä–µ–≤–æ–≥</h2>
            <button onclick="loadProducts()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
            <div id="productsList"></div>
        </div>
    </div>

    <script>
        const API_URL = '/api/alerts';

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ —á–µ—Ä–µ–∑ JSON
        document.getElementById('productForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const al = {
                title: document.getElementById('title').value,
                status: document.getElementById('status').value,
                location: document.getElementById('location').value
            };
            console.log(al.title, al.status, al.location)

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {  
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(al)
                });

                if (response.ok) {
                    alert('‚úÖ –ü—Ä–æ–¥—É–∫—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
                    this.reset();
                    loadProducts();
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞');
                }
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
            }
        });

        // –ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–∞ –ø–æ Id
        document.getElementById("productSearch").addEventListener('submit', async function(e) {
            e.preventDefault();

            const searchId = document.getElementById("searchId").value;
            if (!searchId) {
                alert('‚ùå –í–≤–µ–¥–∏—Ç–µ ID –¥–ª—è –ø–æ–∏—Å–∫–∞');
                return;
            }

            try {
                const response = await fetch(API_URL + `/${searchId}`);
                
                if (response.status === 404) {
                    document.getElementById('foundproducts').innerHTML = 
                        '<p>‚ùå –ü—Ä–æ–¥—É–∫—Ç —Å ID ' + searchId + ' –Ω–µ –Ω–∞–π–¥–µ–Ω</p>';
                    return;
                }
                
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ' + response.status);
                }

                const al = await response.json();
                const foundAlertsList = document.getElementById("foundproducts");
                
                foundAlertsList.innerHTML = `
                    <div class="product-item">
                        <strong>${al.id}. ${al.title}</strong> - ${al.status}.
                        <button onclick="deleteProduct(${al.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                `;
            }
            catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:', error);
                document.getElementById('foundproducts').innerHTML = 
                    '<p>‚ùå –û—à–∏–±–∫–∞: ' + error.message + '</p>';
            }
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤
        async function loadProducts() {
            try {
                const response = await fetch(API_URL);
                const alerts = await response.json();
                
                const alertsList = document.getElementById('productsList');
                if (alerts.length === 0) {
                    alertsList.innerHTML = '<p>–ù–µ—Ç –ø—Ä–æ–¥—É–∫—Ç–æ–≤</p>';
                    return;
                }

                alertsList.innerHTML = alerts.map(alert => `
                    <div class="product-item">
                        <strong>${alert.id}. ${akert.title}</strong> - ${alert.status}.
                        <button onclick="deleteProduct(${alert.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                `).join('');
            } catch (error) {
                document.getElementById('productsList').innerHTML = 
                    '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message + '</p>';
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
        async function deleteProduct(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–¥—É–∫—Ç?')) return;
            
            try {
                const response = await fetch(`${API_URL}/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('‚úÖ –ü—Ä–æ–¥—É–∫—Ç —É–¥–∞–ª–µ–Ω');
                    loadProducts();
                }
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + error.message);
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', loadProducts);
    </script>
</body>
</html>